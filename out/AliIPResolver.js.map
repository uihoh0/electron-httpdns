{"version":3,"sources":["../src/AliIPResolver.ts"],"names":[],"mappings":";;;;;;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AASO,MAAM,UAAU,GAAG,CACtB,aADsB,EAEtB,cAFsB,EAGtB,cAHsB,EAItB,cAJsB,CAAnB;;;AAcO,MAAO,aAAP,SAA6B,0BAA7B,CAA4C;AACtD,EAAA,WAAA,CAAY,MAAZ,EAAgC;AAC5B,UAAM,MAAM,CAAC,OAAP,IAAkB,UAAxB;AACA,SAAK,MAAL,GAAc,MAAM,CAAC,MAArB;AACA,SAAK,SAAL,GAAiB,MAAM,CAAC,SAAxB;AACA,SAAK,YAAL,GAAoB,MAAM,CAAC,YAA3B;AACH;;AAIM,QAAM,OAAN,CAAc,GAAd,EAAyB;AAC5B,UAAM,MAAM,GAAsB,MAAM,KAAK,YAAL,CAAkB,GAAlB,CAAxC;AACA,WAAO,MAAM,CAAC,GAAd;AACH;;AACM,QAAM,gBAAN,CAAuB,SAAvB,EAAsD,IAAtD,EAAkE;AACrE,QAAI,CAAC,SAAL,EAAgB;AACZ,aAAO,EAAP;AACH;;AACD,UAAM,GAAG,GAAI,IAAI,IAAJ,EAAb;AACA,QAAI,SAAS,GAAG,GAAG,CAAC,UAAJ,CAAe,GAAG,CAAC,UAAJ,KAAmB,CAAlC,CAAhB;AACA,IAAA,SAAS,GAAG,IAAI,CAAC,KAAL,CAAW,SAAS,GAAG,IAAvB,CAAZ;AACA,WAAO,UAAU,SAAS,IAAI,KAAK,SAAS,gBAAgB,IAAI,MAAM,SAAS,MAAM,mBAAI,GAAG,IAAI,IAAI,KAAK,MAAM,IAAI,SAAS,EAAvC,CAA0C,EAA/H;AACH;;AAtBqD,C","sourcesContent":["\nimport md5 from 'md5'\n\nimport BasicIPResolver, { IPArray, HttpDnsConfig } from './BasicIPResolver'\n\nexport interface AliHttpDNSResult {\n    readonly ips: Array<string>\n    readonly host: string,\n    readonly ttl: number,\n    readonly origin_ttl: number\n}\n\nexport const aliServers = [\n    '203.107.1.1',\n    '203.107.1.33',\n    '203.107.1.34',\n    '203.107.1.35'\n]\n\nexport interface AliDnsConfig extends HttpDnsConfig {\n    secret: string,\n    accountId: string,\n    servers?: Array<string> | string,\n    httpExecutor: any\n}\n\nexport default class AliIPResolver extends BasicIPResolver {\n    constructor(config: AliDnsConfig) {\n        super(config.servers || aliServers)\n        this.secret = config.secret\n        this.accountId = config.accountId\n        this.httpExecutor = config.httpExecutor\n    }\n    protected httpExecutor: any\n    protected secret:string\n    protected accountId: string\n    public async request(url: string): Promise<IPArray | null | undefined> {\n        const result: AliHttpDNSResult  = await this.httpExecutor(url)\n        return result.ips;\n    }\n    public async createRequestUrl(dnsServer: string | undefined, host: string): Promise<string> {\n        if (!dnsServer) {\n            return '';\n        }\n        const now = (new Date());\n        let timestamp = now.setMinutes(now.getMinutes() + 4)\n        timestamp = Math.round(timestamp / 1000);\n        return `http://${dnsServer}/${this.accountId}/sign_d?host=${host}&t=${timestamp}&s=${md5(`${host}-${this.secret}-${timestamp}`)}`\n    }\n}"],"sourceRoot":""}
